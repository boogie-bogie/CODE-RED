<main id='rescueRequestMainContainer'>
  <div id='rescueRequestContainer'>
    <div id='helperInfo'>

      현재
      {{distance}}km 이내에
      <br />
      도움을 요청할 수 있는
      <br />
      이웃이
      {{lengthOfList helpers}}
      명 있습니다.
    </div>
    <form>
      <input type='text' name='context' id='SendRescueMessage' placeholder='구조요청 메세지를 적어주세요' value="" />

      {{#each helpers}}
      <input type="hidden" name="HelperId" value="{{user_id}}">
      {{/each}}


      <button id='sendHelpBtn' type='submit'>구조요청 보내기</button>
    </form>
  </div>
</main>

<script>


  document.querySelector('#sendHelpBtn').addEventListener('click', async (e) => {
    e.preventDefault();

    const context = document.querySelector('#SendRescueMessage').value;
    const helperIdInputs = document.getElementsByName('HelperId');
    const helperIds = Array.from(helperIdInputs).map(input => input.value);
    try {
      const response = await fetch('/mayday/sos', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          context: context,
          helpers: helperIds
        }),
      });

      if (response.ok) {
        alert('요청을 보냈습니다.')
        window.location.href = '/mayday/rescue-request-loading'
      } else {
        console.error('요청 실패:', response.statusText);
        alert('요청 실패하였습니다..')
      }
    } catch (error) {
      console.error('요청 실패:', error);
    }
  });


</script>